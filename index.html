<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PriSongs - High Quality Music</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .active-tab { color: #6366f1; border-bottom: 2px solid #6366f1; }
        .player-blur { background: rgba(10, 10, 15, 0.9); backdrop-filter: blur(20px); }
        input[type='range'] { accent-color: #6366f1; cursor: pointer; }
        .song-card:hover { transform: translateY(-6px); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .loader-spin { border: 3px solid rgba(99, 102, 241, 0.1); border-top: 3px solid #6366f1; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-[#050508] text-slate-100 min-h-screen flex flex-col">

    <!-- Top Navigation -->
    <nav class="sticky top-0 z-50 bg-[#050508]/80 backdrop-blur-md border-b border-white/5 p-4">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-5">
            <div class="flex items-center gap-2 cursor-pointer" onclick="location.reload()">
                <div class="bg-indigo-600 p-2 rounded-xl shadow-lg shadow-indigo-600/20">
                    <i data-lucide="play" class="fill-white text-white w-5 h-5"></i>
                </div>
                <span class="text-2xl font-extrabold tracking-tighter">Pri<span class="text-indigo-500">Songs</span></span>
            </div>

            <form id="search-form" class="relative w-full max-w-xl">
                <i data-lucide="search" class="absolute left-4 top-3 text-slate-500 w-4 h-4"></i>
                <input type="text" id="search-input" placeholder="Search full tracks, artists, or albums..." 
                    class="w-full bg-white/5 border border-white/10 rounded-2xl py-2.5 pl-12 pr-4 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all text-sm">
            </form>

            <div class="flex gap-8 font-bold text-[10px] tracking-[0.2em] text-slate-500 uppercase">
                <button id="tab-home" class="active-tab py-1 transition-all">Explore</button>
                <button id="tab-library" class="hover:text-white py-1 transition-all">My Library</button>
            </div>
        </div>
    </nav>

    <!-- Main Section -->
    <main class="container mx-auto p-6 flex-1 overflow-y-auto">
        
        <!-- API Connection Status -->
        <div id="api-status" class="mb-8 flex items-center justify-between bg-white/5 p-3 rounded-2xl border border-white/5">
            <div class="flex items-center gap-3">
                <div id="status-dot" class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                <span id="status-text" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">PriSongs Server: Active</span>
            </div>
            <div id="loader" class="hidden"><div class="loader-spin"></div></div>
        </div>

        <h2 id="section-title" class="text-3xl font-extrabold tracking-tight mb-8">Trending Hits</h2>

        <!-- Songs Grid -->
        <div id="songs-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
            <!-- Loading Placeholders -->
            <div class="bg-white/5 aspect-square rounded-3xl animate-pulse"></div>
            <div class="bg-white/5 aspect-square rounded-3xl animate-pulse"></div>
            <div class="bg-white/5 aspect-square rounded-3xl animate-pulse"></div>
        </div>

        <!-- Empty/Error State -->
        <div id="msg-state" class="hidden py-32 flex flex-col items-center justify-center text-slate-600 gap-4">
            <i data-lucide="music-4" class="w-16 h-16 opacity-10"></i>
            <p id="msg-text" class="text-sm font-medium">Search for your favorite song to start the party.</p>
        </div>
    </main>

    <!-- Floating Player Bar -->
    <footer id="player-bar" class="player-blur border-t border-white/5 p-4 sticky bottom-0 z-50 translate-y-full transition-transform duration-500">
        <div class="container mx-auto flex items-center justify-between gap-6">
            <!-- Track Info -->
            <div class="flex items-center gap-4 w-1/4 min-w-[180px]">
                <img id="p-img" src="" class="w-14 h-14 rounded-2xl object-cover shadow-2xl border border-white/10">
                <div class="truncate">
                    <h4 id="p-title" class="font-bold text-sm truncate">Song Title</h4>
                    <p id="p-artist" class="text-[10px] text-indigo-400 font-bold uppercase truncate tracking-wider mt-0.5">Artist Name</p>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex flex-col items-center flex-1 max-w-xl">
                <div class="flex items-center gap-8 mb-2">
                    <button class="text-slate-500 hover:text-white transition-colors"><i data-lucide="repeat" size="18"></i></button>
                    <button id="p-play" class="w-12 h-12 bg-white text-black rounded-full flex items-center justify-center hover:scale-110 active:scale-90 transition-all shadow-xl">
                        <i id="p-icon" data-lucide="play" fill="currentColor"></i>
                    </button>
                    <button class="text-slate-500 hover:text-white transition-colors"><i data-lucide="shuffle" size="18"></i></button>
                </div>
                <div class="w-full flex items-center gap-3 text-[10px] font-mono text-slate-500">
                    <span id="p-cur">0:00</span>
                    <div class="flex-1 relative h-1 bg-white/10 rounded-full group">
                        <div id="p-fill" class="absolute inset-y-0 left-0 bg-indigo-500 rounded-full group-hover:bg-indigo-400 transition-colors shadow-[0_0_10px_rgba(99,102,241,0.5)]"></div>
                        <input type="range" id="p-progress" value="0" step="0.1" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    </div>
                    <span id="p-total">0:00</span>
                </div>
            </div>

            <!-- Volume -->
            <div class="flex items-center justify-end gap-3 w-1/4">
                <i data-lucide="volume-2" class="text-slate-500 w-4 h-4"></i>
                <input type="range" id="p-volume" min="0" max="1" step="0.05" value="0.8" class="w-20 h-1">
            </div>
        </div>
    </footer>

    <audio id="audio-engine" crossorigin="anonymous"></audio>

    <script>
        /**
         * PriSongs Resilient API Config
         * Using multiple mirrors to avoid "API Connection Failed"
         */
        const MIRRORS = [
            "https://saavn.dev/api",
            "https://jio-saavn-api.vercel.app/api",
            "https://saavn.me/api"
        ];
        
        let mirrorIndex = 0;
        let library = JSON.parse(localStorage.getItem('prisongs_lib') || '[]');
        let currentTab = 'home';
        const audio = document.getElementById('audio-engine');

        const refreshIcons = () => lucide.createIcons();

        // --- Multi-Server Search Logic ---
        async function fetchPriSongs(query) {
            document.getElementById('loader').classList.remove('hidden');
            const mirror = MIRRORS[mirrorIndex];
            
            try {
                const res = await fetch(`${mirror}/search/songs?query=${encodeURIComponent(query)}`);
                const data = await res.json();
                
                if (data.success && data.data.results.length > 0) {
                    renderSongs(data.data.results);
                    updateStatus(`PriSongs Server: Online`, 'bg-green-500');
                } else {
                    handleFail(query);
                }
            } catch (err) {
                console.warn("Mirror failed, trying next mirror...");
                handleFail(query);
            } finally {
                document.getElementById('loader').classList.add('hidden');
            }
        }

        function handleFail(query) {
            if (mirrorIndex < MIRRORS.length - 1) {
                mirrorIndex++;
                fetchPriSongs(query);
            } else {
                mirrorIndex = 0;
                updateStatus("Offline: Checking Connection", 'bg-red-500');
                document.getElementById('msg-state').classList.remove('hidden');
                document.getElementById('msg-text').innerText = "Servers are busy. Please check your internet or try again later.";
            }
        }

        function renderSongs(songs) {
            document.getElementById('msg-state').classList.add('hidden');
            const grid = document.getElementById('songs-grid');
            grid.innerHTML = songs.map(song => {
                const img = song.image[song.image.length - 1].url;
                const stream = song.downloadUrl[song.downloadUrl.length - 1].url;
                return `
                <div class="song-card bg-white/5 p-4 rounded-[2rem] border border-white/5 hover:bg-white/10 transition-all cursor-pointer group"
                    onclick='playPriSong(${JSON.stringify({id: song.id, title: song.name, artist: song.artists.primary[0].name, img, url: stream}).replace(/'/g, "&apos;")})'>
                    <div class="relative aspect-square mb-4 overflow-hidden rounded-[1.5rem] shadow-2xl">
                        <img src="${img}" class="w-full h-full object-cover transition-transform duration-700">
                        <div class="absolute inset-0 bg-indigo-900/40 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all">
                            <div class="bg-white text-black p-3 rounded-full shadow-2xl transform scale-75 group-hover:scale-100 transition-transform">
                                <i data-lucide="play" fill="currentColor"></i>
                            </div>
                        </div>
                    </div>
                    <h3 class="font-bold text-sm truncate px-1">${song.name}</h3>
                    <p class="text-indigo-400 text-[9px] font-bold uppercase truncate tracking-widest mt-1 px-1">${song.artists.primary[0].name}</p>
                </div>
                `;
            }).join('');
            refreshIcons();
        }

        function playPriSong(track) {
            document.getElementById('player-bar').classList.remove('translate-y-full');
            document.getElementById('p-img').src = track.img;
            document.getElementById('p-title').innerText = track.title;
            document.getElementById('p-artist').innerText = track.artist;

            audio.src = track.url;
            audio.play();
            updatePlayUI(true);

            // Auto-Add to Local History
            if (!library.find(t => t.id === track.id)) {
                library.unshift(track);
                localStorage.setItem('prisongs_lib', JSON.stringify(library));
            }
        }

        function updatePlayUI(playing) {
            const btn = document.getElementById('p-play');
            btn.innerHTML = playing ? '<i data-lucide="pause" fill="currentColor"></i>' : '<i data-lucide="play" fill="currentColor" class="ml-1"></i>';
            refreshIcons();
        }

        function updateStatus(text, color) {
            document.getElementById('status-text').innerText = text;
            document.getElementById('status-dot').className = `w-2 h-2 rounded-full ${color}`;
        }

        // --- Interaction ---

        document.getElementById('search-form').onsubmit = (e) => {
            e.preventDefault();
            const q = document.getElementById('search-input').value;
            mirrorIndex = 0;
            currentTab = 'home';
            updateTabs();
            fetchPriSongs(q);
        };

        document.getElementById('p-play').onclick = () => {
            if (audio.paused) { audio.play(); updatePlayUI(true); }
            else { audio.pause(); updatePlayUI(false); }
        };

        audio.ontimeupdate = () => {
            const perc = (audio.currentTime / audio.duration) * 100;
            document.getElementById('p-fill').style.width = `${perc || 0}%`;
            document.getElementById('p-progress').value = perc || 0;
            document.getElementById('p-cur').innerText = formatTime(audio.currentTime);
            document.getElementById('p-total').innerText = formatTime(audio.duration);
        };

        document.getElementById('p-progress').oninput = (e) => audio.currentTime = (e.target.value / 100) * audio.duration;
        document.getElementById('p-volume').oninput = (e) => audio.volume = e.target.value;

        const formatTime = (s) => isNaN(s) ? "0:00" : `${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2, '0')}`;

        function updateTabs() {
            document.getElementById('tab-home').className = currentTab === 'home' ? 'active-tab py-1' : 'hover:text-white py-1 transition-all';
            document.getElementById('tab-library').className = currentTab === 'library' ? 'active-tab py-1' : 'hover:text-white py-1 transition-all';
            document.getElementById('section-title').innerText = currentTab === 'home' ? 'Top Discovery' : 'My PriSongs Library';
        }

        document.getElementById('tab-home').onclick = () => { currentTab = 'home'; updateTabs(); fetchPriSongs("Trending Songs"); };
        document.getElementById('tab-library').onclick = () => { currentTab = 'library'; updateTabs(); renderSongs(library); };

        window.onload = () => { refreshIcons(); fetchPriSongs("Weekly Top Hits"); };
    </script>
</body>
</html>

