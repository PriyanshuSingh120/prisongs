<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prisongs - Full Length Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        .active-tab { color: #818cf8; border-bottom: 2px solid #818cf8; }
        .player-gradient { background: linear-gradient(to top, #000 0%, #0f172a 100%); }
        input[type='range'] { accent-color: #6366f1; cursor: pointer; }
        .glass { background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(15px); }
        .song-card:hover img { transform: scale(1.05); }
    </style>
</head>
<body class="bg-[#020617] text-slate-100 min-h-screen flex flex-col font-sans selection:bg-indigo-500">

    <!-- Top Navigation -->
    <nav class="glass sticky top-0 z-50 border-b border-slate-800 p-4">
        <div class="container mx-auto flex flex-col md:flex-row items-center justify-between gap-4">
            <div class="flex items-center gap-2 text-indigo-500 font-black text-2xl tracking-tighter cursor-pointer" onclick="location.reload()">
                <i data-lucide="music"></i> <span>Prisongs<span class="text-white">PRO</span></span>
            </div>

            <form id="search-form" class="relative w-full max-w-lg">
                <i data-lucide="search" class="absolute left-3 top-2.5 text-slate-500 w-5 h-5"></i>
                <input type="text" id="search-input" placeholder="Search full songs (e.g. Starboy, Arijit...)" 
                    class="w-full bg-slate-900 border border-slate-800 rounded-full py-2 px-10 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all text-sm">
            </form>

            <div class="flex gap-8 font-bold text-xs tracking-widest text-slate-500 uppercase">
                <button id="tab-home" class="active-tab">Explore</button>
                <button id="tab-library" class="hover:text-white transition-colors">My Library</button>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="container mx-auto p-6 flex-1 overflow-y-auto">
        
        <!-- Status & Error Messages -->
        <div id="status-box" class="hidden mb-6 p-4 rounded-xl bg-indigo-500/10 border border-indigo-500/20 text-indigo-400 text-sm flex items-center gap-3">
            <i data-lucide="info" class="w-4 h-4"></i>
            <span id="status-text">Ready to stream...</span>
        </div>

        <div id="error-box" class="hidden mb-6 p-4 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 text-sm flex items-center gap-3">
            <i data-lucide="alert-circle" class="w-4 h-4"></i>
            <span id="error-text">Network error occurred.</span>
        </div>

        <!-- Section Title -->
        <div class="flex items-center justify-between mb-8">
            <h2 id="section-title" class="text-3xl font-black tracking-tight">Featured Tracks</h2>
            <div id="loader" class="hidden">
                <div class="w-5 h-5 border-2 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
            </div>
        </div>

        <!-- Songs Grid -->
        <div id="songs-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-6">
            <!-- Loading Placeholders -->
            <div class="animate-pulse bg-slate-900 rounded-2xl aspect-square"></div>
            <div class="animate-pulse bg-slate-900 rounded-2xl aspect-square"></div>
            <div class="animate-pulse bg-slate-900 rounded-2xl aspect-square"></div>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="hidden py-32 flex flex-col items-center justify-center text-slate-600 gap-4">
            <i data-lucide="disc" class="w-16 h-16 opacity-20"></i>
            <p class="text-lg">No songs found. Try a different search!</p>
        </div>
    </main>

    <!-- Fixed Bottom Player Bar -->
    <footer id="player-bar" class="glass border-t border-slate-800 p-4 sticky bottom-0 z-50 transform translate-y-full transition-transform duration-500">
        <div class="container mx-auto flex items-center justify-between gap-6">
            <!-- Track Info -->
            <div class="flex items-center gap-4 w-1/4 min-w-[150px]">
                <img id="player-img" src="" class="w-14 h-14 rounded-lg object-cover shadow-2xl border border-white/5">
                <div class="truncate">
                    <h4 id="player-title" class="font-bold text-sm truncate">Song Title</h4>
                    <p id="player-artist" class="text-[10px] text-indigo-400 font-bold uppercase truncate">Artist Name</p>
                </div>
            </div>

            <!-- Controls -->
            <div class="flex flex-col items-center flex-1 max-w-xl">
                <div class="flex items-center gap-6 mb-2">
                    <button class="text-slate-500 hover:text-white"><i data-lucide="skip-back"></i></button>
                    <button id="play-btn" class="w-12 h-12 bg-white text-black rounded-full flex items-center justify-center hover:scale-110 active:scale-95 transition-all shadow-xl">
                        <i id="play-icon" data-lucide="play" fill="currentColor"></i>
                    </button>
                    <button class="text-slate-500 hover:text-white"><i data-lucide="skip-forward"></i></button>
                </div>
                <div class="w-full flex items-center gap-3 text-[10px] font-mono text-slate-500">
                    <span id="time-cur">0:00</span>
                    <input type="range" id="progress" value="0" step="0.1" class="w-full h-1 bg-slate-800 rounded-full appearance-none cursor-pointer">
                    <span id="time-total">0:00</span>
                </div>
            </div>

            <!-- Volume -->
            <div class="flex items-center justify-end gap-3 w-1/4">
                <i data-lucide="volume-2" class="text-slate-500 w-4 h-4"></i>
                <input type="range" id="volume" min="0" max="1" step="0.1" value="0.8" class="w-20 h-1">
            </div>
        </div>
    </footer>

    <!-- Audio Element -->
    <audio id="audio-engine" preload="auto"></audio>

    <script>
        /**
         * CONFIGURATION
         * We use the public JioSaavn API.
         */
        const API_URL = "https://saavn.dev/api";
        let myLibrary = JSON.parse(localStorage.getItem('melody_pro_lib') || '[]');
        let currentTab = 'home';
        let isPlaying = false;

        const audio = document.getElementById('audio-engine');
        const songsGrid = document.getElementById('songs-grid');
        const loader = document.getElementById('loader');
        const errorBox = document.getElementById('error-box');

        function refreshIcons() { lucide.createIcons(); }

        // --- Core Functions ---

        async function fetchMusic(query) {
            errorBox.classList.add('hidden');
            loader.classList.remove('hidden');
            
            try {
                // Fetch from Saavn API
                const res = await fetch(`${API_URL}/search/songs?query=${encodeURIComponent(query)}`);
                const data = await res.json();
                
                if (data.success && data.data.results.length > 0) {
                    displaySongs(data.data.results);
                } else {
                    showError("No songs found for your search.");
                }
            } catch (err) {
                showError("API Connection Failed. Please check your internet or try again later.");
                console.error(err);
            } finally {
                loader.classList.add('hidden');
            }
        }

        function displaySongs(songs) {
            if (songs.length === 0) {
                document.getElementById('empty-state').classList.remove('hidden');
                songsGrid.innerHTML = '';
                return;
            }
            document.getElementById('empty-state').classList.add('hidden');

            songsGrid.innerHTML = songs.map(song => {
                const img = song.image[song.image.length - 1].url; // Highest quality image
                const streamUrl = song.downloadUrl[song.downloadUrl.length - 1].url; // Highest quality audio
                
                return `
                <div class="song-card bg-slate-900/40 p-4 rounded-2xl border border-slate-800 hover:bg-slate-800/80 transition-all cursor-pointer group"
                    onclick='playSong(${JSON.stringify({id: song.id, title: song.name, artist: song.artists.primary[0].name, img, url: streamUrl}).replace(/'/g, "&apos;")})'>
                    <div class="relative aspect-square mb-4 overflow-hidden rounded-xl shadow-lg">
                        <img src="${img}" class="w-full h-full object-cover transition-transform duration-700">
                        <div class="absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all">
                            <div class="bg-white text-black p-3 rounded-full shadow-2xl transform translate-y-2 group-hover:translate-y-0 transition-transform">
                                <i data-lucide="play" fill="currentColor"></i>
                            </div>
                        </div>
                    </div>
                    <h3 class="font-bold text-sm truncate">${song.name}</h3>
                    <p class="text-slate-500 text-[10px] font-bold uppercase truncate tracking-widest mt-1">${song.artists.primary[0].name}</p>
                </div>
                `;
            }).join('');
            refreshIcons();
        }

        function playSong(song) {
            const playerBar = document.getElementById('player-bar');
            playerBar.classList.remove('translate-y-full');
            
            document.getElementById('player-img').src = song.img;
            document.getElementById('player-title').innerText = song.title;
            document.getElementById('player-artist').innerText = song.artist;

            audio.src = song.url;
            audio.play().then(() => setPlayState(true)).catch(err => {
                showError("Audio format not supported by browser.");
            });

            // Auto-Add to Library (LocalStorage)
            if (!myLibrary.find(t => t.id === song.id)) {
                myLibrary.unshift(song);
                localStorage.setItem('melody_pro_lib', JSON.stringify(myLibrary));
            }
        }

        function setPlayState(playing) {
            isPlaying = playing;
            const icon = document.getElementById('play-icon');
            document.getElementById('play-btn').innerHTML = playing ? 
                '<i data-lucide="pause" fill="currentColor"></i>' : 
                '<i data-lucide="play" fill="currentColor" class="ml-1"></i>';
            refreshIcons();
        }

        function showError(msg) {
            errorBox.classList.remove('hidden');
            document.getElementById('error-text').innerText = msg;
            songsGrid.innerHTML = '';
        }

        // --- Interaction ---

        document.getElementById('search-form').onsubmit = (e) => {
            e.preventDefault();
            const q = document.getElementById('search-input').value;
            currentTab = 'home';
            updateUI();
            fetchMusic(q);
        };

        document.getElementById('play-btn').onclick = () => {
            if (audio.paused) {
                audio.play();
                setPlayState(true);
            } else {
                audio.pause();
                setPlayState(false);
            }
        };

        audio.ontimeupdate = () => {
            const progress = (audio.currentTime / audio.duration) * 100;
            document.getElementById('progress').value = progress || 0;
            document.getElementById('time-cur').innerText = formatTime(audio.currentTime);
            document.getElementById('time-total').innerText = formatTime(audio.duration);
        };

        document.getElementById('progress').oninput = (e) => {
            audio.currentTime = (e.target.value / 100) * audio.duration;
        };

        document.getElementById('volume').oninput = (e) => {
            audio.volume = e.target.value;
        };

        function formatTime(s) {
            if (isNaN(s)) return "0:00";
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return `${m}:${sec < 10 ? '0' : ''}${sec}`;
        }

        function updateUI() {
            document.getElementById('tab-home').className = currentTab === 'home' ? 'active-tab' : 'hover:text-white transition-colors';
            document.getElementById('tab-library').className = currentTab === 'library' ? 'active-tab' : 'hover:text-white transition-colors';
            document.getElementById('section-title').innerText = currentTab === 'home' ? 'Discovery' : 'My Cloud Library';
        }

        document.getElementById('tab-home').onclick = () => {
            currentTab = 'home';
            updateUI();
            fetchMusic("Top Hits");
        };

        document.getElementById('tab-library').onclick = () => {
            currentTab = 'library';
            updateUI();
            displaySongs(myLibrary);
        };

        // Initialize App
        window.onload = () => {
            refreshIcons();
            fetchMusic("Trending Now");
        };

    </script>
</body>
</html>

